<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kinetia CMS</title>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    #login-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #login-screen input {
      padding: 10px;
      margin-top: 10px;
    }
    #cms-container {
      display: none;
    }
  </style>
  <script>
    window.CMS_MANUAL_INIT = true;
  </script>
</head>
<body>

  <!-- Login screen -->
  <div id="login-screen">
    <h2>ðŸ”’ Acceso restringido</h2>
    <p>Introduce tu clave para acceder al CMS</p>
    <input type="password" id="password" placeholder="Clave..." />
    <button onclick="validateAccess()">Entrar</button>
    <p id="error" style="color: red; display: none;">Clave incorrecta</p>
  </div>

  <!-- CMS container (hidden by default) -->
  <div id="cms-container"></div>

  <!-- CMS script -->
  <script src="https://unpkg.com/decap-cms@^2.0.0/dist/decap-cms.js"></script>
  <script>
    const CORRECT_PASSWORD = "X5<gYAL6/F]F39l{z5ql"; // Cambia la clave si lo deseas
  
    function validateAccess() {
      const input = document.getElementById("password").value.trim();
      if (input === CORRECT_PASSWORD) {
        document.getElementById("login-screen").style.display = "none";
        document.getElementById("cms-container").style.display = "block";
  
        // ESPERA a que la librerÃ­a estÃ© completamente cargada
        if (typeof CMS !== "undefined") {
          CMS.init({
            config: {
              backend: {
                name: "github",
                repo: "JxViii/Kinetia",
                branch: "main",
                auth_type: "token",
                token: "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"
              },
              media_folder: "public/images/uploads",
              public_folder: "/images/uploads",
              collections: [
                {
                  name: "blog",
                  label: "Blog",
                  folder: "src/blog",
                  create: true,
                  slug: "{{slug}}",
                  fields: [
                    { label: "Title", name: "title", widget: "string" },
                    { label: "Date", name: "date", widget: "datetime" },
                    { label: "Body", name: "body", widget: "markdown" }
                  ]
                }
              ]
            }
          });
        } else {
          console.error("Decap CMS no se ha cargado aÃºn.");
          alert("Hubo un error cargando el CMS. Intenta refrescar la pÃ¡gina.");
        }
      } else {
        document.getElementById("error").style.display = "block";
      }
    }
  
    // IMPORTANTE: escucha el evento 'load' para asegurar que todo estÃ¡ cargado
    window.addEventListener("load", () => {
      console.log("PÃ¡gina y scripts cargados");
    });
  </script>
  

</body>
</html>
